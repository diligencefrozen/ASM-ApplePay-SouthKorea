<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
    <title>ì• í”Œí˜ì´ ê°€ë§¹ì  ì°¾ê¸° - ëª¨ë°”ì¼</title>
    <link rel="stylesheet" href="mobile.css">
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=d51b1a671a08a16ab1a8b8b139507d1c&libraries=services"></script>
</head>
<body>
    <!-- ì§€ë„ ì˜ì—­ -->
    <div id="map" style="width: 100%; height: 80vh;"></div>

    <!-- ê´‘ê³  ë°°ë„ˆ -->
    <div id="ad-banner">
        <a href="https://github.com/diligencefrozen" target="_blank">
            <img src="https://via.placeholder.com/728x90" alt="ê´‘ê³  ë°°ë„ˆ">
        </a>
    </div>

    <!-- ê²€ìƒ‰ ì°½ -->
    <div id="search-box">
        <input type="text" id="search-input" placeholder="ì¥ì†Œë¥¼ ê²€ìƒ‰í•˜ì„¸ìš”.">
        <button id="search-submit">ê²€ìƒ‰</button>
    </div>

    <!-- í˜„ì¬ ìœ„ì¹˜ ë²„íŠ¼ -->
    <div id="current-location">
        <button id="current-location-btn">ë‚´ ìœ„ì¹˜</button>
    </div>
    
    <!-- íŒ¨ì¹˜ë…¸íŠ¸ ì˜ì—­ì´ë‚˜ ëª¨ë°”ì¼ ë²„ì „ì—ì„œëŠ” í•„ë…ì‚¬í•­ ì˜ì—­ìœ¼ë¡œ ëŒ€ì²´. -->
    <div id="patch-notes">
        <button id="patch-notes-toggle">ğŸ“Œí•„ë…ì‚¬í•­</button>
        <div id="patch-notes-content">
            <h3>ğŸ“Œí•„ë…ì‚¬í•­</h3>
            <span style="display: block; margin-bottom: 10px; color: #999; font-weight: bold;">ğŸ“… Last Update: 11/02/2024 23:43 KST</span>
            <span style="display: block; margin-bottom: 10px;"><b>ğŸ“ ë‚´ ìœ„ì¹˜ ë²„íŠ¼:</b> í˜„ì¬ ìœ„ì¹˜ë¡œ ì§€ë„ë¥¼ ì´ë™í•©ë‹ˆë‹¤.</span>
            <span style="display: block; margin-bottom: 10px;">ğŸ <b>iPhone ì‚¬ìš©ìëŠ”</b> <a href="https://apps.apple.com/kr/app/%EB%84%A4%EC%9D%B4%EB%B2%84-naver/id393499958" style="color: #007aff;">ë„¤ì´ë²„ ì•±</a>ì„ ì‚¬ìš©í•˜ì„¸ìš”.</span>
            <span style="display: block; margin-bottom: 10px;">ğŸ <b>iPad ë° Mac ì‚¬ìš©ìëŠ”</b> <a href="https://www.google.com/chrome/" style="color: #007aff;">Chrome</a>ì„ ì‚¬ìš©í•˜ì„¸ìš”.</span>
            <span style="display: block; margin-bottom: 10px;">âš ï¸ <b>ì£¼ì˜:</b> ë™ì¼ ê±´ë¬¼ ë‚´ì˜ ë§¤ì¥ì€ ë™ì¼ ì¥ì†Œë¡œ ë¶„ë¥˜ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
            <span style="display: block; margin-bottom: 10px;">â­ <b>ê°€ë§¹ì  ë°ì´í„° ì¶œì²˜:</b> <a href="https://www.hyundaicard.com/cpu/ug/CPUUG4001_02.hc?tabindex=1" style="color: #007aff;">í˜„ëŒ€ì¹´ë“œ ì• í”Œí˜ì´ ë¬¸ì„œ</a></span>
        </div>
    </div>    

    <!-- ë¶ˆëŸ¬ì˜¤ê¸° ë²„íŠ¼ -->
    <div id="load-stores">
        <button id="load-button">ğŸ” ê°€ë§¹ì  ë¶ˆëŸ¬ì˜¤ê¸°</button>
    </div>

    <script>
        let map;

        document.addEventListener("DOMContentLoaded", function () {
            const container = document.getElementById('map');
            const options = {
                center: new kakao.maps.LatLng(37.34487430629196, 127.93071437137233),
                level: 3,
            };
            map = new kakao.maps.Map(container, options);

            document.getElementById("load-button").addEventListener("click", loadAllStoresAsync);
            document.getElementById("search-submit").addEventListener("click", searchPlaces);
            document.getElementById("current-location-btn").addEventListener("click", moveToCurrentLocation);
        });

        const stores = [
            { keyword: "GS25", imageUrl: "https://github.com/diligencefrozen/applepay-southkorea-map/blob/main/logo/conveniencestore.png?raw=true" },
            { keyword: "CU", imageUrl: "https://github.com/diligencefrozen/applepay-southkorea-map/blob/main/logo/conveniencestore.png?raw=true" },
            { keyword: "ìŠ¤íƒ€ë²…ìŠ¤", imageUrl: "https://github.com/diligencefrozen/applepay-southkorea-map/blob/main/logo/cafe.png?raw=true" },
            { keyword: "ë¡¯ë°ë°±í™”ì ", imageUrl: "https://github.com/diligencefrozen/applepay-southkorea-map/blob/main/logo/departmentstore.png?raw=true" },
            { keyword: "ì½”ìŠ¤íŠ¸ì½”", imageUrl: "https://github.com/diligencefrozen/applepay-southkorea-map/blob/main/logo/mart.png?raw=true" },
        ];

        function createMarkerImage(url) {
            return new kakao.maps.MarkerImage(url, new kakao.maps.Size(24, 35));
        }

        function displayMarker(place, markerImage) {
            if (!place || !place.y || !place.x) return;

            const marker = new kakao.maps.Marker({
                position: new kakao.maps.LatLng(place.y, place.x),
                image: markerImage,
            });
            marker.setMap(map);
        }
        
        async function loadAllStoresAsync() {
            const loadingIndicator = document.createElement("div");
            loadingIndicator.innerText = "ê°€ë§¹ì ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";
            loadingIndicator.style.position = "absolute";
            loadingIndicator.style.top = "10px";
            loadingIndicator.style.left = "50%";
            loadingIndicator.style.transform = "translateX(-50%)";
            loadingIndicator.style.backgroundColor = "rgba(255, 255, 255, 0.8)";
            loadingIndicator.style.padding = "10px";
            loadingIndicator.style.borderRadius = "8px";
            document.body.appendChild(loadingIndicator);
            
            try {
                const placesService = new kakao.maps.services.Places();
                
                for (const store of stores) {
                    await new Promise(resolve => {
                        placesService.keywordSearch(store.keyword, function (data, status) {
                            if (status === kakao.maps.services.Status.OK) {
                                data.forEach(place => {
                                    displayMarker(place, createMarkerImage(store.imageUrl));
                                });
                            } else {
                                console.warn(`ê²€ìƒ‰ ì‹¤íŒ¨: ${store.keyword}, ìƒíƒœ: ${status}`);
                            }
                            resolve();
                        });
                    });
                    await new Promise(resolve => setTimeout(resolve, 200)); // ëŒ€ê¸° ì‹œê°„
                }
            } finally {
                document.body.removeChild(loadingIndicator);
            }
        }

        
        function moveToCurrentLocation() {
            if (!navigator.geolocation) {
                alert("GPSë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.");
                return;
            }
            
            navigator.geolocation.getCurrentPosition(
                function (position) {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const newPosition = new kakao.maps.LatLng(lat, lng);
                    
                    map.setCenter(newPosition);
                    const marker = new kakao.maps.Marker({ position: newPosition });
                    marker.setMap(map);
                },
                
                function (error) {
                    switch (error.code) {
                        case error.PERMISSION_DENIED:
                            alert("ìœ„ì¹˜ ì •ë³´ ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.");
                            break;
                        case error.POSITION_UNAVAILABLE:
                            alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                            break;
                        case error.TIMEOUT:
                            alert("ìœ„ì¹˜ ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.");
                            break;
                        default:
                            alert("ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                    }
                }
            );
        }



        function searchPlaces() {
            const keyword = document.getElementById("search-input").value.trim();
            if (!keyword) {
                alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }

            const placesService = new kakao.maps.services.Places();
            placesService.keywordSearch(keyword, function (data, status) {
                if (status === kakao.maps.services.Status.OK) {
                    map.setCenter(new kakao.maps.LatLng(data[0].y, data[0].x));
                } else {
                    alert("ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.");
                }
            });
        }

        function moveToCurrentLocation() {
            if (!navigator.geolocation) {
                alert("GPSë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.");
                return;
            }

            navigator.geolocation.getCurrentPosition(function (position) {
                const lat = position.coords.latitude;
                const lng = position.coords.longitude;
                const newPosition = new kakao.maps.LatLng(lat, lng);

                map.setCenter(newPosition);
                const marker = new kakao.maps.Marker({ position: newPosition });
                marker.setMap(map);
            }, function () {
                alert("ìœ„ì¹˜ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            });
        }
    </script>
</body>
</html>
